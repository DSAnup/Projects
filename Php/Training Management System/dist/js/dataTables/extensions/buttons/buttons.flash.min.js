/*!
 * Flash export buttons for Buttons and DataTables.
 * 2015 SpryMedia Ltd - datatables.net/license
 *
 * ZeroClipbaord - MIT license
 * Copyright (c) 2012 Joseph Huckaby
 */
!function(a,b){"use strict";var c={version:"1.0.4-TableTools2",clients:{},moviePath:"",nextId:1,$:function(a){return"string"==typeof a&&(a=document.getElementById(a)),a.addClass||(a.hide=function(){this.style.display="none"},a.show=function(){this.style.display=""},a.addClass=function(a){this.removeClass(a),this.className+=" "+a},a.removeClass=function(a){this.className=this.className.replace(new RegExp("\\s*"+a+"\\s*")," ").replace(/^\s+/,"").replace(/\s+$/,"")},a.hasClass=function(a){return!!this.className.match(new RegExp("\\s*"+a+"\\s*"))}),a},setMoviePath:function(a){this.moviePath=a},dispatch:function(a,b,c){var d=this.clients[a];d&&d.receiveEvent(b,c)},register:function(a,b){this.clients[a]=b},getDOMObjectPosition:function(a){var b={left:0,top:0,width:a.width?a.width:a.offsetWidth,height:a.height?a.height:a.offsetHeight};for(""!==a.style.width&&(b.width=a.style.width.replace("px","")),""!==a.style.height&&(b.height=a.style.height.replace("px",""));a;)b.left+=a.offsetLeft,b.top+=a.offsetTop,a=a.offsetParent;return b},Client:function(a){this.handlers={},this.id=c.nextId++,this.movieId="ZeroClipboard_TableToolsMovie_"+this.id,c.register(this.id,this),a&&this.glue(a)}};c.Client.prototype={id:0,ready:!1,movie:null,clipText:"",fileName:"",action:"copy",handCursorEnabled:!0,cssEffects:!0,handlers:null,sized:!1,glue:function(a,b){this.domElement=c.$(a);var d=99;this.domElement.style.zIndex&&(d=parseInt(this.domElement.style.zIndex,10)+1);var e=c.getDOMObjectPosition(this.domElement);this.div=document.createElement("div");var f=this.div.style;f.position="absolute",f.left="0px",f.top="0px",f.width=e.width+"px",f.height=e.height+"px",f.zIndex=d,"undefined"!=typeof b&&""!==b&&(this.div.title=b),0!==e.width&&0!==e.height&&(this.sized=!0),this.domElement&&(this.domElement.appendChild(this.div),this.div.innerHTML=this.getHTML(e.width,e.height).replace(/&/g,"&amp;"))},positionElement:function(){var a=c.getDOMObjectPosition(this.domElement),b=this.div.style;if(b.position="absolute",b.width=a.width+"px",b.height=a.height+"px",0!==a.width&&0!==a.height){this.sized=!0;var d=this.div.childNodes[0];d.width=a.width,d.height=a.height}},getHTML:function(a,b){var d="",e="id="+this.id+"&width="+a+"&height="+b;if(navigator.userAgent.match(/MSIE/)){var f=location.href.match(/^https/i)?"https://":"http://";d+='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="'+f+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,0,0,0" width="'+a+'" height="'+b+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+c.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+e+'"/><param name="wmode" value="transparent"/></object>'}else d+='<embed id="'+this.movieId+'" src="'+c.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+a+'" height="'+b+'" name="'+this.movieId+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+e+'" wmode="transparent" />';return d},hide:function(){this.div&&(this.div.style.left="-2000px")},show:function(){this.reposition()},destroy:function(){var b=this;this.domElement&&this.div&&(a(this.div).remove(),this.domElement=null,this.div=null,a.each(c.clients,function(a,d){d===b&&delete c.clients[a]}))},reposition:function(a){if(a&&(this.domElement=c.$(a),this.domElement||this.hide()),this.domElement&&this.div){var b=c.getDOMObjectPosition(this.domElement),d=this.div.style;d.left=""+b.left+"px",d.top=""+b.top+"px"}},clearText:function(){this.clipText="",this.ready&&this.movie.clearText()},appendText:function(a){this.clipText+=a,this.ready&&this.movie.appendText(a)},setText:function(a){this.clipText=a,this.ready&&this.movie.setText(a)},setFileName:function(a){this.fileName=a,this.ready&&this.movie.setFileName(a)},setAction:function(a){this.action=a,this.ready&&this.movie.setAction(a)},addEventListener:function(a,b){a=a.toString().toLowerCase().replace(/^on/,""),this.handlers[a]||(this.handlers[a]=[]),this.handlers[a].push(b)},setHandCursor:function(a){this.handCursorEnabled=a,this.ready&&this.movie.setHandCursor(a)},setCSSEffects:function(a){this.cssEffects=!!a},receiveEvent:function(a,b){var c;switch(a=a.toString().toLowerCase().replace(/^on/,"")){case"load":if(this.movie=document.getElementById(this.movieId),!this.movie)return c=this,void setTimeout(function(){c.receiveEvent("load",null)},1);if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/))return c=this,setTimeout(function(){c.receiveEvent("load",null)},100),void(this.ready=!0);this.ready=!0,this.movie.clearText(),this.movie.appendText(this.clipText),this.movie.setFileName(this.fileName),this.movie.setAction(this.action),this.movie.setHandCursor(this.handCursorEnabled);break;case"mouseover":this.domElement&&this.cssEffects&&this.recoverActive&&this.domElement.addClass("active");break;case"mouseout":this.domElement&&this.cssEffects&&(this.recoverActive=!1,this.domElement.hasClass("active")&&(this.domElement.removeClass("active"),this.recoverActive=!0));break;case"mousedown":this.domElement&&this.cssEffects&&this.domElement.addClass("active");break;case"mouseup":this.domElement&&this.cssEffects&&(this.domElement.removeClass("active"),this.recoverActive=!1)}if(this.handlers[a])for(var d=0,e=this.handlers[a].length;e>d;d++){var f=this.handlers[a][d];"function"==typeof f?f(this,b):"object"==typeof f&&2==f.length?f[0][f[1]](this,b):"string"==typeof f&&window[f](this,b)}}},c.hasFlash=function(){try{var a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(a)return!0}catch(b){if(navigator.mimeTypes&&void 0!==navigator.mimeTypes["application/x-shockwave-flash"]&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return!0}return!1},window.ZeroClipboard_TableTools=c;var d=function(a,b){b.attr("id");b.parents("html").length?a.glue(b[0],""):setTimeout(function(){d(a,b)},500)},e=function(b,c){var d="*"===b.filename&&"*"!==b.title&&void 0!==b.title?b.title:b.filename;return-1!==d.indexOf("*")&&(d=d.replace("*",a("title").text())),d=d.replace(/[^a-zA-Z0-9_\u00A1-\uFFFF\.,\-_ !\(\)]/g,""),void 0===c||c===!0?d+b.extension:d},f=function(a,b){var c=b.match(/[\s\S]{1,8192}/g)||[];a.clearText();for(var d=0,e=c.length;e>d;d++)a.appendText(c[d])},g=function(a){return a.newline?a.newline:navigator.userAgent.match(/Windows/)?"\r\n":"\n"},h=function(a,b){for(var c=g(b),d=a.buttons.exportData(b.exportOptions),e=b.fieldBoundary,f=b.fieldSeparator,h=new RegExp(e,"g"),i=void 0!==b.escapeChar?b.escapeChar:"\\",j=function(a){for(var b="",c=0,d=a.length;d>c;c++)c>0&&(b+=f),b+=e?e+(""+a[c]).replace(h,i+e)+e:a[c];return b},k=b.header?j(d.header)+c:"",l=b.footer?c+j(d.footer):"",m=[],n=0,o=d.body.length;o>n;n++)m.push(j(d.body[n]));return{str:k+m.join(c)+l,rows:m.length}},i={available:function(){return c.hasFlash()},init:function(a,e,f){c.moviePath=b.Buttons.swfPath;var g=new c.Client;g.setHandCursor(!0),g.addEventListener("mouseDown",function(b){f._fromFlash=!0,a.button(e[0]).trigger(),f._fromFlash=!1}),d(g,e),f._flash=g},destroy:function(a,b,c){c._flash.destroy()},fieldSeparator:",",fieldBoundary:'"',exportOptions:{},title:"*",filename:"*",extension:".csv",header:!0,footer:!1};b.Buttons.swfPath="http://cdn.datatables.net/buttons/1.0.0/swf/flashExport.swf",b.Api.register("buttons.resize()",function(){a.each(c.clients,function(a,b){void 0!==b.domElement&&b.domElement.parentNode&&b.positionElement()})}),b.ext.buttons.copyFlash=a.extend({},i,{className:"buttons-copy buttons-flash",text:function(a){return a.i18n("buttons.copy","Copy")},action:function(a,b,c,d){if(d._fromFlash){var e=d._flash,g=h(b,d);e.setAction("copy"),f(e,g.str),b.buttons.info(b.i18n("buttons.copyTitle","Copy to clipboard"),b.i18n("buttons.copyInfo",{_:"Copied %d rows to clipboard",1:"Copied 1 row to clipboard"},g.rows),3e3)}},fieldSeparator:"	",fieldBoundary:""}),b.ext.buttons.csvFlash=a.extend({},i,{className:"buttons-csv buttons-flash",text:function(a){return a.i18n("buttons.csv","CSV")},action:function(a,b,c,d){var g=d._flash,i=h(b,d);g.setAction("csv"),g.setFileName(e(d)),f(g,i.str)},escapeChar:'"'}),b.ext.buttons.excelFlash=a.extend({},i,{className:"buttons-excel buttons-flash",text:function(a){return a.i18n("buttons.excel","Excel")},action:function(a,b,c,d){var g="",h=d._flash,i=b.buttons.exportData(d.exportOptions),j=function(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(a[c].match(/[^0-9\-\.]/)?'<c t="inlineStr"><is><t>'+a[c].replace(/&(?!amp;)/g,"&amp;").replace(/[\x00-\x1F\x7F-\x9F]/g,"")+"</t></is></c>":'<c t="n"><v>'+a[c]+"</v></c>");return"<row>"+b.join("")+"</row>"};d.header&&(g+=j(i.header));for(var k=0,l=i.body.length;l>k;k++)g+=j(i.body[k]);d.footer&&(g+=j(i.footer)),h.setAction("excel"),h.setFileName(e(d)),f(h,g)},extension:".xlsx"}),b.ext.buttons.pdfFlash=a.extend({},i,{className:"buttons-pdf buttons-flash",text:function(a){return a.i18n("buttons-2.html","PDF")},action:function(a,b,c,d){var g=d._flash,h=b.buttons.exportData(d.exportOptions),i=b.table().node().offsetWidth,j=b.columns(d.columns).indexes().map(function(a){return b.column(a).header().offsetWidth/i});g.setAction("pdf"),g.setFileName(e(d)),f(g,JSON.stringify({title:e(d,!1),message:d.message,colWidth:j.toArray(),orientation:d.orientation,size:d.pageSize,header:d.header?h.header:null,footer:d.footer?h.footer:null,body:h.body}))},extension:".pdf",orientation:"portrait",pageSize:"A4",message:"",newline:"\n"})}(jQuery,jQuery.fn.dataTable);